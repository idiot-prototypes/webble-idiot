---
layout: default
---

<img class="pageIcon" src="icon.png">
<h1>Wi-Fi Provisioning</h1>

<p>This Web Bluetooth application implements the <em>Wi-Fi Scan and Connect Services</em> as defined in the <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-42683-ATWINC3400-BLE-WiFi-Scan-and-Connect-Services-Guide_UserGuide.pdf">Atmel ATWINC3400 User Guide</a>

<script>
  if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }
</script>

<form>
  <button id="pair-and-connect">Pair and connect</button>
  <button id="disconnect">Disconnect</button>
  <button id="get-scanning-mode" >Get Scanning Mode</button>
</form>

<script>
  var ChromeSamples = {
    log: function() {
      var line = Array.prototype.slice.call(arguments).map(function(argument) {
        return typeof argument === 'string' ? argument : JSON.stringify(argument);
      }).join(' ');

      document.querySelector('#log').textContent += line + '\n';
    },

    clearLog: function() {
      document.querySelector('#log').textContent = '';
    },

    setStatus: function(status) {
      document.querySelector('#status').textContent = status;
    },

    setContent: function(newContent) {
      var content = document.querySelector('#content');
      while(content.hasChildNodes()) {
        content.removeChild(content.lastChild);
      }
      content.appendChild(newContent);
    }
  };
</script>

<h3>Live Output</h3>
<div id="output" class="output">
  <div id="content">{{ include.initial_output_content }}</div>
  <div id="status"></div>
  <pre id="log"></pre>
</div>

<script>
  var bleDevice = null;

  function onPairAndConnectButtonClick() {
    if (bleDevice != null) {
      onDisconnectButtonClick();
    }

    log('Requesting Bluetooth Device...');
    navigator.bluetooth.requestDevice({ filters: [{
      services: ['fb8c0001-d224-11e4-85a1-0002a5d5c51b'] }] })
    .then(device => {
      log('> Name:             ' + device.name);
      log('> Id:               ' + device.id);
      log('> Connected:        ' + device.gatt.connected);

      log('Connecting to Bluetooth Device...');
      device.gatt.connect()
      .then(server => {
        log('> Connected:        ' + device.gatt.connected);
        log('> Bluetooth Device connected');
        bleDevice = device;
      })
      .catch(error => {
        log('Argh! ' + error);
      });
    })
    .catch(error => {
      log('Argh! ' + error);
    });
  }

  function onDisconnectButtonClick() {
    let device = bleDevice;
    if (device == null) {
      return;
    }

    log('Disconnecting from Bluetooth Device...');
    log('> Connected:        ' + device.gatt.connected);
    if (device.gatt.connected) {
      device.gatt.disconnect();
      log('> Bluetooth Device disconnected');
    }
    bleDevice = null;
  }

  function onGetScanningModeButtonClick() {
    if (bleDevice == null) {
      return;
    }

    log('Get Scanning Mode...');
    bleDevice.gatt.getPrimaryService('fb8c0001-d224-11e4-85a1-0002a5d5c51b')
    .then(service => {
      log('> Service:          ' + service);
      return service.getCharacteristic('fb8c0002-d224-11e4-85a1-0002a5d5c51b');
    })
    .then(characteristic => {
      log('> Characteristic:   ' + characteristic);
      return characteristic.readValue();
    })
    .then(value => {
      log('> Value:            ' + value);
      return value.getUint8();
    })
    .then(scanningMode => {
      log('> Scanning Mode:    ' + scanningMode);
    })
    .catch(error => {
      log('Argh! ' + error);
    });
  }
</script>

<script>
  document.querySelector('#pair-and-connect').addEventListener('click', function(event) {
    event.stopPropagation();
    event.preventDefault();

    if (isWebBluetoothEnabled()) {
      ChromeSamples.clearLog();
      onPairAndConnectButtonClick();
    }
  });

  document.querySelector('#disconnect').addEventListener('click', function(event) {
    event.stopPropagation();
    event.preventDefault();

    if (isWebBluetoothEnabled()) {
      ChromeSamples.clearLog();
      onDisconnectButtonClick();
    }
  });

  document.querySelector('#get-scanning-mode').addEventListener('click', function(event) {
    event.stopPropagation();
    event.preventDefault();

    if (isWebBluetoothEnabled()) {
      ChromeSamples.clearLog();
      onGetScanningModeButtonClick();
    }
  });
</script>

<script>
  log = ChromeSamples.log;

  function isWebBluetoothEnabled() {
    if (navigator.bluetooth) {
      return true;
    } else {
      ChromeSamples.setStatus('Web Bluetooth API is not available.\n' +
          'Please make sure the "Experimental Web Platform features" flag is enabled.');
      return false;
    }
  }
</script>
